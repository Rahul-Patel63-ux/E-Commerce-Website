<form id="editvendor_form" action="{% url 'updateVender' v.id %}" method="post" enctype="multipart/form-data">
      {% csrf_token %}

              <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_company_name" class="form-label">Company Name <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_company_name" class="form-control" name="uvendor_company_name" value="{{ v.vendor_company_name }}" placeholder="Ex:Grofresh" >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_company_url" class="form-label">Website <span style="color:red;">*</span></label>
                        <input type="url" id="vendor_company_url" class="form-control" name="uvendor_company_url" value="{{ v.vendor_company_url }}" placeholder="Ex:https://www.Grofresh.com/" >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_aadhaar" class="form-label">Aadhaar <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_aadhaar" class="form-control" name="uvendor_aadhaar" value="{{ v.vendor_aadhaar }}" placeholder="Ex:6161 3001 0823" >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_tan_number" class="form-label">TAN Number <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_tan_number" class="form-control" name="uvendor_tan_number" value="{{ v.vendor_tan_number }}" placeholder="Ex:ABCD12345X" >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_gst_number" class="form-label">GST Number <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_gst_number" class="form-control" name="uvendor_gst_number" value="{{ v.vendor_gst_number }}" placeholder="Ex:27AAACS6638R1Z5">
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_type" class="form-label">Vendor Type <span style="color:red;">*</span></label>
                        <select name="uvendor_type" id="vendor_type" class="form-select" >
                            <option value="">Select Type</option>
                            {% for vendor_type in vendor_types %}
                                <option value="{{ vendor_type.id }}" {% if vendor_type.id == v.vendor_type_ref.id %}selected{% endif %}>{{ vendor_type.vendor_type }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_name" class="form-label">Vendor Name <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_name" class="form-control" name="uvendor_name" value="{{ v.vendor_name }}" placeholder="Ex:Kumar" >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_phonenumber" class="form-label">Phone Number <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_phonenumber" class="form-control" name="uvendor_phonenumber" value="{{ v.vendor_phone_number }}" placeholder="Ex:9632587415">
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_alt_phonenumber" class="form-label">Alt Phone</label>
                        <input type="text" id="vendor_alt_phonenumber" class="form-control" name="uvendor_alt_phonenumber" value="{{ v.vendor_alt_number }}" placeholder="Ex:6938523645">
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_email" class="form-label">Email <span style="color:red;">*</span></label>
                        <input type="email" id="vendor_email" class="form-control" name="uvendor_email" value="{{ v.vendor_email }}" placeholder="Ex:sample@gmail.com" >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_poc_name" class="form-label">POC <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_poc_name" class="form-control" name="uvendor_poc_name" value="{{ v.vendor_poc }}" placeholder="Ex:Rahul" >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_poc_phonenumber" class="form-label">POC Phone <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_poc_phonenumber" class="form-control" name="uvendor_poc_phonenumber" value="{{ v.vendor_poc_phone }}" placeholder="Ex:8527419638" >
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-12 mb-4">
                        <label for="vendor_country" class="form-label">Country <span style="color:red;">*</span></label>
                        <select name="uvendor_country" id="vendor_country" class="form-select create_vendor_country" >
                            <option value="">Select Country</option>
                            {% for country in countries %}
                                <option value="{{ country.id }}" {% if country.id == v.vendor_country_ref.id %}selected{% endif %}>{{ country.country_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-12 mb-4">
                        <label for="vendor_state" class="form-label">State <span style="color:red;">*</span></label>
                        <select name="uvendor_state" id="vendor_state" class="form-select create_vendor_state" >
                            <option value="">Select State</option>
                            {% for state in states %}
                                <option value="{{ state.id }}" data-country="{{ state.country_ref.id }}" {% if state.id == v.vendor_state_ref.id %}selected{% endif %}>{{ state.state_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-12 mb-4">
                        <label for="vendor_city" class="form-label">City <span style="color:red;">*</span></label>
                        <select name="uvendor_city" id="vendor_city" class="form-select create_vendor_city" >
                            <option value="">Select City</option>
                            {% for city in cities %}
                                <option value="{{ city.id }}" data-state="{{ city.state_ref.id }}" {% if city.id == v.vendor_city_ref.id %}selected{% endif %}>{{ city.city_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-12 mb-4">
                        <label for="vendor_area" class="form-label">Area <span style="color:red;">*</span></label>
                        <select name="uvendor_area" id="vendor_area" class="form-select create_vendor_area" >
                            <option value="">Select Area</option>
                            {% for area in areas %}
                                <option value="{{ area.id }}" data-city="{{ area.city_ref.id }}" {% if area.id == v.vendor_area_ref.id %}selected{% endif %}>{{ area.area_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-12 col-md-12 col-sm-12 mb-4">
                        <label for="vendor_address" class="form-label">Address <span style="color:red;">*</span></label>
                        <textarea class="form-control" id="vendor_address" name="uvendor_address" rows="3" placeholder="Ex: 123/456, Main Road, Secunderabad, Near XYZ School, Hyderabad, Telangana, 500001" >{{ v.vendor_address }}</textarea>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_account_number" class="form-label">Account Number <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_account_number" class="form-control" name="uvendor_account_number" value="{{ v.vendor_account_number }}" placeholder="Ex:123456678909808989" >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_ifsc_code" class="form-label">IFSC Code <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_ifsc_code" class="form-control" name="uvendor_ifsc_code" value="{{ v.vendor_ifsc_code }}" placeholder="Ex:SBIN0007058"  >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_bank_name" class="form-label">Bank Name <span style="color:red;">*</span></label>
                        <select name="uvendor_bank_name" id="vendor_bank_name" class="form-select" >
                            <option value="">Select Bank</option>
                            {% for bank in banks %}
                                <option value="{{ bank.id }}" {% if bank.id == v.vendor_bank_ref.id %}selected{% endif %}>{{ bank.bank_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_bank_branch" class="form-label">Bank Branch <span style="color:red;">*</span></label>
                        <input type="text" id="vendor_bank_branch" class="form-control" name="uvendor_bank_branch" value="{{ v.vendor_bank_branch }}" placeholder="Ex:State Bank of India" >
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_bank_acc_type" class="form-label">Account Type <span style="color:red;">*</span></label>
                        <select name="uvendor_bank_acc_type" id="vendor_bank_acc_type" class="form-select" >
                            <option value="">Select Type</option>
                            {% for account_type in account_types %}
                                <option value="{{ account_type.id }}" {% if account_type.id == v.vendor_account_type.id %}selected{% endif %}>{{ account_type.account_type }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <label for="vendor_company_logo" class="form-label">Company Logo <span style="color:red;"><sub class="text-secondary">(.jpg/.png)</sub></span></label>
                        <input type="file" id="vendor_company_logo" class="form-control" name="uvendor_company_logo">
                        {% if v.vendor_company_logo %}
                            <small class="text-muted">Current logo: <a href="{{ v.vendor_company_logo.url }}" target="_blank" class="pt-3"><img src="{{ v.vendor_company_logo.url }}" alt="Company Logo" style="max-width: 50px; max-height: 50px; vertical-align: middle;"></a></small>
                        {% endif %}
                    </div>
                    <div class="col-lg-12 col-md-12 col-sm-12 mb-4">
                        <label for="vendor_description" class="form-label">Description <span style="color:red;">*</span></label>
                        <textarea class="form-control ckeditor-classic" id="vendor_description" name="uvendor_description" rows="5" >{{ v.vendor_description|safe }}</textarea>
                    </div>
              </div>



        <div class="modal-footer">
            <button type="submit" id="editvendorFormSubmit" class="btn text-white" style="background-color:#405189;">Save</button>
            <button type="button" class="btn bg-light" data-bs-dismiss="modal">Close</button>
        </div>
    </form>


<!-- Initialize CKEditor -->
<script>
    document.querySelectorAll(".ckeditor-classic").forEach(function(element) {
        ClassicEditor
            .create(element, {
                toolbar: ['heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', '|', 'alignment', '|', 'blockQuote', 'undo', 'redo'],
                alignment: {
                    options: ['left', 'center', 'right', 'justify']
                },
                height: '200px'
            })
            .then(function(editor) {
                editor.ui.view.editable.element.style.height = '200px';
            })
            .catch(function(error) {
                console.error(error);
            });
    });
</script>


<!--script validations-->
<script>
    $(document).ready(function() {
    // Function to capitalize first letter
    function capitalizeFirstLetter(str) {
        if (str.length > 0) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        return str;
    }

    // Custom validation method for capitalizing first letter
    $.validator.addMethod("capitalizeFirstLetter", function(value, element) {
        $(element).val(capitalizeFirstLetter(value));
        return true;
    }, "");
    $.validator.addMethod("letterStartNoLeadingSpace", function(value, element) {
        return this.optional(element) || /^[a-zA-Z][^\s].*/.test(value);
    }, "Company name must start with a letter and have no leading space.");

    $.validator.addMethod("atLeastOneAlpha", function(value, element) {
        return this.optional(element) || /[a-zA-Z]/.test(value);
    }, "Please enter at least one alphabetical character.");

    // Add custom validation method to restrict double spaces
    $.validator.addMethod("noDoubleSpace", function(value, element) {
        return this.optional(element) || !/\s{2,}/.test(value);
    }, "Double spaces are not allowed.");
    $.validator.addMethod("alphaSpaceOnly", function(value, element) {
        return this.optional(element) || /^[a-zA-Z\s]*$/.test(value);
    }, "Only alphabetical characters and spaces are allowed.");


    // Custom validation method for file size
    $.validator.addMethod("maxFileSize", function(value, element, param) {
        if (element.files && element.files.length > 0) {
            return element.files[0].size <= param * 1024 * 1024; // Convert MB to bytes
        }
        return true;
    }, "File size must not exceed {0}MB.");

    $.validator.addMethod("twelveDigits", function(value, element) {
        return this.optional(element) || /^\d{12}$/.test(value);
    }, "Aadhaar number must be exactly 12 digits.");

    // Method to check that the number does not start with 0 or 1
    $.validator.addMethod("noZeroOrOneStart", function(value, element) {
        return this.optional(element) || /^[2-9]\d{11}$/.test(value);
    }, "Aadhaar number must not start with 0 or 1.");

    // Method to check that all digits are not identical
    $.validator.addMethod("nonIdenticalDigits", function(value, element) {
        return this.optional(element) || !/^(\d)\1{11}$/.test(value);
    }, "Aadhaar number digits must not all be identical.");

    // Custom validation method for TAN number (10 characters, format: 4 letters, 5 digits, 1 letter)
    $.validator.addMethod("validTAN", function(value, element) {
        return this.optional(element) || /^[A-Z]{4}\d{5}[A-Z]{1}$/.test(value);
    }, "Please enter a valid TAN number (e.g., ABCD12345X).");

    // Custom validation method for GST number (15 characters, specific format)
    $.validator.addMethod("validGST", function(value, element) {
        return this.optional(element) || /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/.test(value);
    }, "Please enter a valid GST number (e.g., 27AAACS6638R1Z5).");

    // Custom validation method for phone number (10 digits)
    $.validator.addMethod("validPhone", function(value, element) {
        return this.optional(element) || /^[6-9]\d{9}$/.test(value);
    }, "Please enter a valid 10-digit phone number starting with 6, 7, 8, or 9.");

    // Custom validation method for IFSC code (11 characters, format: 4 letters, 0, 6 digits/letters)
    $.validator.addMethod("validIFSC", function(value, element) {
        return this.optional(element) || /^[A-Z]{4}0[A-Z0-9]{6}$/.test(value);
    }, "Please enter a valid IFSC code (e.g., SBIN0007058).");

    //Address
    $.validator.addMethod("validAddressChars", function(value, element) {
        return this.optional(element) || /^[a-zA-Z0-9\s,.\/#-]*$/.test(value);
    }, "Only letters, numbers, spaces, commas, periods, hyphens, slashes, and hashtags are allowed.");
    $.validator.addMethod("noLeadingSpace", function(value, element) {
        return this.optional(element) || !/^\s/.test(value);
    }, "Address must not start with a space.");

    $('#editvendor_form').validate({
        rules: {
            uvendor_company_name: {
                required: true,
                atLeastOneAlpha:true,
                noDoubleSpace:true,
                letterStartNoLeadingSpace:true,
                minlength: 3,
                maxlength: 100,
                capitalizeFirstLetter: true
            },
            uvendor_company_url: {
                required: true,
                url: true
            },
            uvendor_aadhaar: {
                required: true,
                twelveDigits:true,
                noZeroOrOneStart:true,
                nonIdenticalDigits:true
            },
            uvendor_tan_number: {
                required: true,
                validTAN: true
            },
            uvendor_gst_number: {
                required: true,
                validGST: true
            },
            uvendor_type: {
                required: true
            },
            uvendor_name: {
                required: true,
                alphaSpaceOnly:true,
                noDoubleSpace:true,
                letterStartNoLeadingSpace:true,
                minlength: 2,
                maxlength: 50,
                capitalizeFirstLetter: true
            },
            uvendor_phonenumber: {
                required: true,
                validPhone: true
            },
            uvendor_alt_phonenumber: {
                validPhone: true
            },
            uvendor_email: {
                required: true,
                email: true
            },
            uvendor_poc_name: {
                required: true,
                minlength: 2,
                maxlength: 50,
                capitalizeFirstLetter: true
            },
            uvendor_poc_phonenumber: {
                required: true,
                validPhone: true
            },
            uvendor_country: {
                required: true
            },
            uvendor_state: {
                required: true
            },
            uvendor_city: {
                required: true
            },
            uvendor_area: {
                required: true
            },
            uvendor_address: {
                required: true,
                validAddressChars:true,
                atLeastOneAlpha:true,
                noDoubleSpace:true,
                noLeadingSpace:true,
                minlength: 5,
                maxlength: 200
            },
            uvendor_account_number: {
                required: true,
                digits: true,
                minlength: 9,
                maxlength: 18
            },
            uvendor_ifsc_code: {
                required: true,
                validIFSC: true
            },
            uvendor_bank_name: {
                required: true
            },
            uvendor_bank_branch: {
                required: true,
                minlength: 3,
                maxlength: 100,
                capitalizeFirstLetter: true
            },
            uvendor_bank_acc_type: {
                required: true
            },
            uvendor_company_logo: {

                extension: "jpg|png",

                maxFileSize: 2
            },
            uvendor_description: {
                required: true,
                minlength: 10,
                maxlength: 500
            }
        },
        messages: {
            uvendor_company_name: {
                required: "Please enter the company name.",
                minlength: "Company name should be at least 3 characters.",
                maxlength: "Company name should not exceed 100 characters."
            },
            uvendor_company_url: {
                required: "Please enter the company website.",
                url: "Please enter a valid URL (e.g., https://www.example.com)."
            },
            uvendor_aadhaar: {
                required: "Please enter the Aadhaar number.",
                validAadhaar: "Please enter a valid 12-digit Aadhaar number."
            },
            uvendor_tan_number: {
                required: "Please enter the TAN number.",
                validTAN: "Please enter a valid TAN number (e.g., ABCD12345X)."
            },
            uvendor_gst_number: {
                required: "Please enter the GST number.",
                validGST: "Please enter a valid GST number (e.g., 27AAACS6638R1Z5)."
            },
            uvendor_type: {
                required: "Please select a vendor type."
            },
            uvendor_name: {
                required: "Please enter the vendor name.",
                letterStartNoLeadingSpace: "Vendor name should start with a letter.",
                minlength: "Vendor name should be at least 2 characters.",
                maxlength: "Vendor name should not exceed 50 characters."
            },
            uvendor_phonenumber: {
                required: "Please enter the phone number.",
                validPhone: "Please enter a valid 10-digit phone number starting with 6, 7, 8, or 9."
            },
            uvendor_alt_phonenumber: {
                validPhone: "Please enter a valid 10-digit alternate phone number starting with 6, 7, 8, or 9."
            },
            uvendor_email: {
                required: "Please enter the email address.",
                email: "Please enter a valid email address."
            },
            uvendor_poc_name: {
                required: "Please enter the POC name.",
                minlength: "POC name should be at least 2 characters.",
                maxlength: "POC name should not exceed 50 characters."
            },
            uvendor_poc_phonenumber: {
                required: "Please enter the POC phone number.",
                validPhone: "Please enter a valid 10-digit POC phone number starting with 6, 7, 8, or 9."
            },
            uvendor_country: {
                required: "Please select a country."
            },
            uvendor_state: {
                required: "Please select a state."
            },
            uvendor_city: {
                required: "Please select a city."
            },
            uvendor_area: {
                required: "Please select an area."
            },
            uvendor_address: {
                required: "Please enter the address.",
                minlength: "Address should be at least 5 characters.",
                maxlength: "Address should not exceed 200 characters."
            },
            uvendor_account_number: {
                required: "Please enter the account number.",
                digits: "Account number must contain only digits.",
                minlength: "Account number should be at least 9 digits.",
                maxlength: "Account number should not exceed 18 digits."
            },
            uvendor_ifsc_code: {
                required: "Please enter the IFSC code.",
                validIFSC: "Please enter a valid IFSC code (e.g., SBIN0007058)."
            },
            uvendor_bank_name: {
                required: "Please select a bank name."
            },
            uvendor_bank_branch: {
                required: "Please enter the bank branch.",
                minlength: "Bank branch should be at least 3 characters.",
                maxlength: "Bank branch should not exceed 100 characters."
            },
            uvendor_bank_acc_type: {
                required: "Please select an account type."
            },
            uvendor_company_logo: {

                extension: "Only .jpg or .png files are allowed.",

                maxFileSize: "Logo size must not exceed 2MB."
            },
            uvendor_description: {
                required: "Please enter a description.",
                minlength: "Description should be at least 10 characters.",
                maxlength: "Description should not exceed 500 characters."
            }
        },
        submitHandler: function(form) {
            console.log("Form is valid.");
            form.submit();
        }
    });
});
</script>


<script>

    $(document).ready(function() {
            // When country changes, fetch states
            $('.create_vendor_country').change(function() {
                var countryId = $(this).val();
                if (countryId) {
                    $.ajax({
                        url: "{% url 'get_states' %}",
                        data: {
                            'country_id': countryId
                        },
                        dataType: 'json',
                        success: function(data) {
                            $('.create_vendor_state').empty();
                            $('.create_vendor_state').append('<option value="">Select State</option>');
                            $.each(data.states, function(index, state) {
                                $('.create_vendor_state').append(
                                    $('<option>').val(state.id).text(state.state_name)
                                );
                            });
                            // Clear city and area dropdowns
                            $('.create_vendor_city').empty();
                            $('.create_vendor_city').append('<option value="">Select City</option>');
                            $('.create_vendor_area').empty();
                            $('.create_vendor_area').append('<option value="">Select Area</option>');
                        }
                    });
                } else {
                    $('.create_vendor_state').empty();
                    $('.create_vendor_state').append('<option value="">Select State</option>');
                    $('.create_vendor_city').empty();
                    $('.create_vendor_city').append('<option value="">Select City</option>');
                    $('.create_vendor_area').empty();
                    $('.create_vendor_area').append('<option value="">Select Area</option>');
                }
            });

            // When state changes, fetch cities
            $('.create_vendor_state').change(function() {
                var stateId = $(this).val();
                if (stateId) {
                    $.ajax({
                        url: "{% url 'get_cities' %}",
                        data: {
                            'state_id': stateId
                        },
                        dataType: 'json',
                        success: function(data) {
                            $('.create_vendor_city').empty();
                            $('.create_vendor_city').append('<option value="">Select City</option>');
                            $.each(data.cities, function(index, city) {
                                $('.create_vendor_city').append(
                                    $('<option>').val(city.id).text(city.city_name)
                                );
                            });
                            // Clear area dropdown
                            $('.create_vendor_area').empty();
                            $('.create_vendor_area').append('<option value="">Select Area</option>');
                        }
                    });
                } else {
                    $('.create_vendor_city').empty();
                    $('.create_vendor_city').append('<option value="">Select City</option>');
                    $('.create_vendor_area').empty();
                    $('.create_vendor_area').append('<option value="">Select Area</option>');
                }
            });

            // When city changes, fetch areas
            $('.create_vendor_city').change(function() {
                var cityId = $(this).val();
                if (cityId) {
                    $.ajax({
                        url: "{% url 'get_areas' %}",
                        data: {
                            'city_id': cityId
                        },
                        dataType: 'json',
                        success: function(data) {
                            $('.create_vendor_area').empty();
                            $('.create_vendor_area').append('<option value="">Select Area</option>');
                            $.each(data.areas, function(index, area) {
                                $('.create_vendor_area').append(
                                    $('<option>').val(area.id).text(area.area_name)
                                );
                            });
                        }
                    });
                } else {
                    $('.create_vendor_area').empty();
                    $('.create_vendor_area').append('<option value="">Select Area</option>');
                }
            });
        });
    </script>